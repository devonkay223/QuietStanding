<!-- <!doctype html>
<html lang=en>
  <head>
    <meta charset='utf-8'>
    <script src='gen.lib.js'></script>
  </head>
  <body>
    <p style="width:25em;" > 
    <span style="font-weight:bold">Click/touch in the page to begin</span>. 
    This example shows how you can use the "input" ugen to plug regular Web Audio API 
    nodes into a AudioWorklet node created by genish.js. 
    If you open your developer's console, you should see the generated callback function. 
    </p>
  </body>
  <script>

    const click = function() {
      console.log("touch start recognized")
      const ctx = utilities.ctx

      // create a WAAPI oscillator
      const sine = ctx.createOscillator()
      sine.frequency.value = 2

      // use this gain to scale the output of our oscillator
      const gain  = ctx.createGain()
      gain.gain.value = 40

      sine.connect( gain )

      utilities.playWorklet( 
        cycle( add( 220, input('freqMod', 0, 0 ) ) ), 
        'test', // this name isn't really important
        true    // print generated code to developers console
      ).then( node => {
        gain.connect( node )
        sine.start()

        console.log( 'playing...' )
      })

      window.removeEventListener( 'touchstart', click )
    }

    window.onload = ()=> {
      window.addEventListener( 'touchstart', click )
      window.addEventListener( 'click', click )

      genish.export( window )

      // audio context will be stored in utilities.ctx
      utilities.createContext()
    }

  </script>
</html> -->

<!doctype html>
<html lang=en>
    <head>
        <title>QuietStanding</title>
        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.js"></script> -->
        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js"></script> -->
        <script src="gen.lib.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Rubik" rel="stylesheet">
        <link rel="stylesheet" href="style.css" type="text/css">
    </head>
    <body>
        <h1>Quiet Standing 3</h1>
        <!-- <button id="accelPermsButton"  style="height:50px;" onclick="getPerm()"><h2>Get Accelerometer Permissions</h2></button> -->
        <!-- <button id="accelPermsButton"  style="height:50px;" onclick="audio()"><h2>Audio</h2></button> -->
        <button id="test1"  style="height:50px;" onclick="test1()"><h2>test1</h2></button> 
        <button id="test2"  style="height:50px;" onclick="test2()"><h2>test2</h2></button> 
        <button id="test3"  style="height:50px;" onclick="test3()"><h2>test3</h2></button> 
        <button id="test4"  style="height:50px;" onclick="test4()"><h2>test4</h2></button> 
        <!-- <script  type="text/javascript" src="Motion.js"></script> -->
    </body>
    <script>
        const audio = function() {
            console.log("touch start recognized")
            const ctx = utilities.ctx
            const baseFrequency = 180,
            c2m = 1.4,
            index = param( 'idx', 0, 0.5, 1 )

            // create our oscillator for modulation
            let  modulator = cycle( mul( baseFrequency, c2m ) );


            // scale amplitude based on index value, re-assign
            modulator = mul( modulator, mul( baseFrequency, index ) );
            let addVar= add( baseFrequency, modulator );

            // create carrier oscillator and modulate frequency
            const carrier = cycle( add( baseFrequency, modulator ) );
            //utilities.playWorklet(carrier);
            index.value = 6585;
            console.log(index);
            console.log(index.value);

            // utilities.playWorklet( 
            //     cycle( add( 220, input('freqMod', 0, 0 ) ) ), 
            //     'test', // this name isn't really important
            //     true    // print generated code to developers console
            // ).then( node => {
            //     gain.connect( node )
            //     sine.start()

            //     console.log( 'playing...' )
            // })

            utilities.playWorklet( cycle( addVar ) )
        
            window.removeEventListener( 'touchstart', click )
        }
    
        window.onload = ()=> {
            //window.addEventListener( 'touchstart', audio )
            //window.addEventListener( 'click', audio )
    
            genish.export( window )
    
            // audio context will be stored in utilities.ctx
            utilities.createContext()
        }

        function test1() {
            console.log("touch start recognized")
            const ctx = utilities.ctx
            const baseFrequency = 180,
            c2m = 1.4,
            index = param( 'idx', 0, 0.5, 1 )

            utilities.playWorklet( cycle( mul( baseFrequency, c2m ) ) )
        
            //window.removeEventListener( 'touchstart', click )
        }

        function test2() {
            console.log("touch start recognized")
            const ctx = utilities.ctx
            const baseFrequency = 180,
            c2m = 1.4,
            index = param( 'idx', 0, 0.5, 1 )

            // create our oscillator for modulation
            let  modulator = cycle( mul( baseFrequency, c2m ) );


            // scale amplitude based on index value, re-assign
            modulator = mul( modulator, mul( baseFrequency, index ) );

            utilities.playWorklet( modulator )
        
            //window.removeEventListener( 'touchstart', click )
        }

        function test3() {
            console.log("touch start recognized")
            const ctx = utilities.ctx
            const baseFrequency = 180,
            c2m = 1.4,
            index = param( 'idx', 0, 0.5, 1 )

            utilities.playWorklet( cycle(baseFrequency) )
        
            //window.removeEventListener( 'touchstart', click )
        }

        function test4() {
            console.log("touch start recognized")
            const ctx = utilities.ctx
            const baseFrequency = 180,
            c2m = 1.4
            //index = param( 'idx', 0, 0.5, 1 )

            pattern = [ 440, 660, 880, 1100 ]
            idx = 0
            frequency = param( pattern[ idx ] )

            utilities.playWorklet( cycle( frequency ) )

            // change frequency every 100ms (approximately, setInterval is not sample accurate) 
            intrvl = setInterval( ()=> { 
            frequency.value = pattern[ idx++ % pattern.length ] 
            }, 100 )



            // // change frequency every 100ms (approximately, setInterval is not sample accurate) 
            // intrvl = setInterval( ()=> { 
            // frequency.value = pattern[ idx++ % pattern.length ] 
            // }, 100 )
            

            // // create carrier oscillator and modulate frequency
            // const carrier = cycle( add( baseFrequency, mul( cycle( mul( baseFrequency, c2m ) ), mul( baseFrequency, index ) ) ) );
            // //utilities.playWorklet(carrier);

            // // utilities.playWorklet( 
            // //     cycle( add( 220, input('freqMod', 0, 0 ) ) ), 
            // //     'test', // this name isn't really important
            // //     true    // print generated code to developers console
            // // ).then( node => {
            // //     gain.connect( node )
            // //     sine.start()

            // //     console.log( 'playing...' )
            // // })

            // utilities.playWorklet( cycle( add( baseFrequency, mul( cycle( mul( baseFrequency, c2m ) ), mul( baseFrequency, index ) ) ) ))
        
            //window.removeEventListener( 'touchstart', click )
        }
    </script>
</html>